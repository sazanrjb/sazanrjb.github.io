<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  

  <title>Leverage laravel's form request to make your code cleaner</title>
  <meta name="description" content="Laravel has a powerful feature called Form Request to perform form validation logic. If we look at laravel’s official documentation, we can find Form Request under Validation section. But it can be used for much more purposes than just a validation.

">
  <meta name="author" content="Sajan Rajbhandari">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Leverage laravel's form request to make your code cleaner">
  <meta name="twitter:description" content="Laravel has a powerful feature called Form Request to perform form validation logic. If we look at laravel’s official documentation, we can find Form Request under Validation section. But it can be used for much more purposes than just a validation.

">
  
  <meta name="twitter:creator" content="sazanrjb">
  
  <meta name="twitter:image" content="/images/favicons/favicon-194x194.png" />

  <meta property="og:type" content="article">
  <meta property="og:title" content="Leverage laravel's form request to make your code cleaner">
  <meta property="og:description" content="Laravel has a powerful feature called Form Request to perform form validation logic. If we look at laravel’s official documentation, we can find Form Request under Validation section. But it can be used for much more purposes than just a validation.

">
  <meta property="og:image" content="/images/favicons/favicon-194x194.png" />

  <link rel="apple-touch-icon" sizes="57x57" href="/images/favicons/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/images/favicons/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/images/favicons/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/images/favicons/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/images/favicons/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/images/favicons/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/images/favicons/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/images/favicons/apple-touch-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicons/apple-touch-icon-180x180.png">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-194x194.png" sizes="194x194">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/png" href="/images/favicons/android-chrome-192x192.png" sizes="192x192">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-16x16.png" sizes="16x16">
  <link rel="manifest" href="/images/favicons/manifest.json">
  <link rel="shortcut icon" href="/images/favicons/favicon.ico">
  <meta name="msapplication-TileColor" content="#ffc40d">
  <meta name="msapplication-TileImage" content="/images/favicons/mstile-144x144.png">
  <meta name="theme-color" content="#ffffff">
  
  <link rel="stylesheet" href="/css/main.css?1564822324395785288">
  <link rel="canonical" href="https://sazanrjb.com.np/2018/leverage-laravels-form-request-optimize-and-make-code-cleaner/">
  <link rel="alternate" type="application/rss+xml" title="Sajan Rajbhandari" href="/feed.xml">
</head>


  <body>
    <span class="mobile btn-mobile-menu">
  <i class="icon icon-list btn-mobile-menu__icon"></i>
  <i class="icon icon-x-circle btn-mobile-close__icon hidden"></i>
</span>

<header class="panel-cover" style="background-image: url(/images/cover.jpg)">
  <div class="panel-main">

    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">
        <a href="/" title="link to home of Sajan Rajbhandari">
          <img src="/images/profile.jpg" class="user-image" alt="My Profile Photo">
          <h1 class="panel-cover__title panel-title">Sajan Rajbhandari</h1>
        </a>
        <hr class="panel-cover__divider">
        <p class="panel-cover__description">A simple guy who loves technology.</p>
        <hr class="panel-cover__divider panel-cover__divider--secondary">

        <div class="navigation-wrapper">

          <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">
              <li class="navigation__item"><a href="/#blog" title="link to Sajan Rajbhandari blog" class="blog-button">Blog</a></li>
            </ul>
          </nav>

          <nav class="cover-navigation navigation--social">
            <ul class="navigation">

            
              <!-- Twitter -->
              <li class="navigation__item">
                <a href="http://twitter.com/sazanrjb" title="@sazanrjb on Twitter" target="_blank">
                  <i class="icon icon-social-twitter"></i>
                  <span class="label">Twitter</span>
                </a>
              </li>
            

            
              <!-- Facebook -->
              <li class="navigation__item">
                <a href="http://fb.me/sazanrjb" title="sazanrjb on Facebook" target="_blank">
                  <i class="icon icon-social-facebook"></i>
                  <span class="label">Facebook</span>
                </a>
              </li>
            

            
              <!-- LinkedIn -->
              <li class="navigation__item">
                <a href="https://www.linkedin.com/in/sazanrjb" title="sazanrjb on LinkedIn" target="_blank">
                  <i class="icon icon-social-linkedin"></i>
                  <span class="label">LinkedIn</span>
                </a>
              </li>
            

            
              <!-- GitHub -->
              <li class="navigation__item">
                <a href="https://www.github.com/sazanrjb" title="sazanrjb on GitHub" target="_blank">
                  <i class="icon icon-social-github"></i>
                  <span class="label">GitHub</span>
                </a>
              </li>
            

            
              <!-- Email -->
              <li class="navigation__item">
                <a href="mailto:sazanrjb@gmail.com" title="Email sazanrjb@gmail.com" target="_blank">
                  <i class="icon icon-mail"></i>
                  <span class="label">Email</span>
                </a>
              </li>
            

            <!-- RSS -->
            <li class="navigation__item">
              <a href="/feed.xml" title="Subscribe" target="_blank">
                <i class="icon icon-rss"></i>
                <span class="label">RSS</span>
              </a>
            </li>

            </ul>
          </nav>

        </div>

      </div>

    </div>

    <div class="panel-cover--overlay"></div>
  </div>
</header>


    <div class="content-wrapper">
      <div class="content-wrapper__inner">
        <article class="post-container post-container--single">
  <header class="post-header">
    <div class="post-meta">
      <time datetime="2018-04-25 01:42" class="post-meta__date date">25 Apr 2018</time>
      
      &#8226; <span class="post-meta__tags">on <a href="/tags/#laravel">laravel</a> <a href="/tags/#programming">programming</a> </span>
      
    </div>
    <h1 class="post-title">Leverage laravel's form request to make your code cleaner</h1>
  </header>

  <section class="post">
    <p>Laravel has a powerful feature called <strong>Form Request</strong> to perform form validation logic. If we look at laravel’s official documentation, we can find <strong>Form Request</strong> under <a href="https://laravel.com/docs/5.6/validation#form-request-validation"><strong>Validation</strong></a> section. But it can be used for much more purposes than just a validation.</p>

<p>First of all, let’s see how we can make a request class. Laravel has the following artisan command to create a form request class:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>php artisan make:request CreateProductRequest
</code></pre></div></div>
<p>The above command will generate a file inside <code class="highlighter-rouge">app/Http/Requests</code> directory.</p>

<p>The file will contain two methods, <code class="highlighter-rouge">authorize</code> and <code class="highlighter-rouge">rules</code>. The <code class="highlighter-rouge">authorize</code> method is used to check if the user has authority to make this request. While in <code class="highlighter-rouge">rules</code> method, we specify different rules that needs to be passed before moving to the controller.</p>

<p>To apply this validation rules, we just need to inject this request class in our controller method like below:</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">function</span> <span class="nf">store</span><span class="p">(</span><span class="nx">CreateProductRequest</span> <span class="nv">$request</span><span class="p">)</span>
<span class="p">{</span>
	<span class="o">...</span>
<span class="p">}</span>
</code></pre></div></div>
<p>You can view more about it on laravel’s <a href="https://laravel.com/docs/5.6/validation#introduction">official documentation</a>.</p>

<p>Besides validation, request classes can be used to optimize and make controller classes look cleaner.</p>

<h2 id="custom-rule-class">Custom Rule class</h2>
<p>In many cases, <a href="https://laravel.com/docs/5.5/validation#available-validation-rules">built-in validation rules</a> will be fine. But there will be many cases when custom rules need to be made.</p>

<p>Lets say, we have two tables, <code class="highlighter-rouge">categories</code> and <code class="highlighter-rouge">products</code>. <code class="highlighter-rouge">products</code> table contains a foreign key <code class="highlighter-rouge">category_id</code> which links to 	<code class="highlighter-rouge">categories</code>. A category can have multiple products and product name should be unique in each category.</p>

<table>
  <thead>
    <tr>
      <th>categories</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>id</td>
    </tr>
    <tr>
      <td>name</td>
    </tr>
  </tbody>
</table>

<table>
  <thead>
    <tr>
      <th>products</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>id</td>
    </tr>
    <tr>
      <td>name</td>
    </tr>
    <tr>
      <td>category_id</td>
    </tr>
  </tbody>
</table>

<p>While adding and editing products, we need to check if the product with the given name is already used. This logic can be written in controller but it will make the method look dirty. Instead, we can create a custom <strong>Rule</strong> class introduced from laravel 5.5.</p>

<p>A custom validation rule class can be creating by implementing `
Illuminate\Contracts\Validation\Rule` interface or with the following artisan command:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>php artisan make:rule UniqueProduct
</code></pre></div></div>
<p>It will create a file inside <code class="highlighter-rouge">app\Rules</code> directory. The Rule interface has two methods, <code class="highlighter-rouge">passes</code> and <code class="highlighter-rouge">message</code>. <code class="highlighter-rouge">passes</code> is where we put logic required for the validation. In <code class="highlighter-rouge">message</code>, we can simply return a string if the validation fails.</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Rules</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Contracts\Validation\Rule</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\DB</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UniqueProduct</span> <span class="k">implements</span> <span class="nx">Rule</span>
<span class="p">{</span>
	<span class="k">private</span> <span class="nv">$ignore</span> <span class="o">=</span> <span class="p">[];</span>
	<span class="k">private</span> <span class="nv">$categoryId</span><span class="p">;</span>

	<span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nv">$categoryId</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">categoryId</span> <span class="o">=</span> <span class="nv">$categoryId</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">public</span> <span class="k">function</span> <span class="nf">ignore</span><span class="p">(</span><span class="nv">$column</span><span class="p">,</span> <span class="nv">$value</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ignore</span> <span class="o">=</span> <span class="p">[</span><span class="nv">$column</span><span class="p">,</span> <span class="nv">$value</span><span class="p">];</span>
		<span class="k">return</span> <span class="nv">$this</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">public</span> <span class="k">function</span> <span class="nf">passes</span><span class="p">(</span><span class="nv">$attribute</span><span class="p">,</span> <span class="nv">$value</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="nv">$product</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">::</span><span class="na">table</span><span class="p">(</span><span class="s1">'products'</span><span class="p">)</span>
		<span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$query</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">return</span> <span class="nv">$query</span>
			<span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">'name'</span><span class="p">,</span> <span class="nv">$value</span><span class="p">)</span>
			<span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">'products.category_id'</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">categoryId</span><span class="p">);</span>
		<span class="p">});</span>

		<span class="c1">// While editing product, ignore current product
</span>		<span class="k">if</span> <span class="p">(</span><span class="mi">2</span> <span class="o">===</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ignore</span><span class="p">))</span> <span class="p">{</span>
			<span class="nv">$product</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ignore</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">'&lt;&gt;'</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ignore</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
		<span class="p">}</span>

		<span class="c1">// if &gt; 0, Product with the name already exists
</span>		<span class="k">if</span> <span class="p">(</span><span class="nv">$product</span><span class="o">-&gt;</span><span class="na">count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">public</span> <span class="k">function</span> <span class="nf">message</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="k">return</span> <span class="s1">'The :attribute has already been taken.'</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<p>First of all, the id of the category is passed through the constructor. In the <code class="highlighter-rouge">passes</code> method, at first,  there is a query to check if a product with the same name exists in the table, no fancy here. After that there is a condition to ignore the current product’s row. While editing, we don’t have to check the current product’s data, so for that, we just need to pass the identifier of the product in an array to the ignore method, eg. <code class="highlighter-rouge">['id', 1]</code>.  And in <code class="highlighter-rouge">message</code> method, we just return the error message for the validation.</p>

<p>To use this rule, in the form request class, we only need to instantiate the rule class.</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">CreateProductRequest</span><span class="o">.</span><span class="nx">php</span>
<span class="o">...</span>
<span class="k">public</span> <span class="k">function</span> <span class="nf">rules</span><span class="p">()</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">[</span>
		<span class="s1">'category_id'</span> <span class="o">=&gt;</span> <span class="s1">'required'</span><span class="p">,</span>
		<span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="p">[</span>
			<span class="s1">'bail'</span><span class="p">,</span>
			<span class="s1">'required'</span><span class="p">,</span>
			<span class="k">new</span> <span class="nx">UniqueProduct</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">only</span><span class="p">(</span><span class="s1">'category_id'</span><span class="p">))</span>
		<span class="p">]</span>
	<span class="p">];</span>
<span class="p">}</span>

<span class="nx">UpdateProductRequest</span><span class="o">.</span><span class="nx">php</span>
<span class="o">...</span>
<span class="k">public</span> <span class="k">function</span> <span class="nf">rules</span><span class="p">()</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">[</span>
		<span class="s1">'category_id'</span> <span class="o">=&gt;</span> <span class="s1">'required'</span><span class="p">,</span>
		<span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="p">[</span>
			<span class="s1">'bail'</span><span class="p">,</span>
			<span class="s1">'required'</span><span class="p">,</span>
			<span class="p">(</span><span class="k">new</span> <span class="nx">UniqueProduct</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">only</span><span class="p">(</span><span class="s1">'category_id'</span><span class="p">)))</span>
			<span class="o">-&gt;</span><span class="na">ignore</span><span class="p">(</span><span class="s1">'id'</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">route</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">parameter</span><span class="p">(</span><span class="s1">'productId'</span><span class="p">))</span>
		<span class="p">]</span>
	<span class="p">];</span>
	<span class="c1">// productId is obtained from the route param
</span>	<span class="c1">// Route::put('products/{productId}', '..ProductController@update');
</span><span class="p">}</span>
</code></pre></div></div>
<p>So now both your controller and request class will look cleaner.</p>

<h2 id="addingediting-request-elements">Adding/Editing request elements</h2>
<p>There will be a time when we have to add some elements to the request object. Also, we may need to modify request elements before validating or storing it to the database.</p>

<p>Lets say, while editing a product, the request has manufactured year, date and day as seperate elements, and we need to merge them together to create a single date. Similarly, let’s say product’s attributes are in json format and we need to convert it to array.</p>

<p>One way is to modify them in the controller or service class after receiving the request object. Since, we are talking about making our code cleaner, we can utilize request classes to make our changes.</p>

<p>As of laravel 5, laravel calls <code class="highlighter-rouge">getValidatorInstance</code> method and it gets through several methods, to call <code class="highlighter-rouge">all()</code> to get the input data for validation. We can override this method in form request class to add our own, or modify the request elements.</p>

<h3 id="adding-elements-to-request-data">Adding elements to request data</h3>
<p><code class="highlighter-rouge">merge</code> method will merge the request data with our own array data, which can be useful to add our own data to the request object.</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">function</span> <span class="nf">all</span><span class="p">()</span>
<span class="p">{</span>
	<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">merge</span><span class="p">([</span><span class="s1">'date_of_manufacture'</span> <span class="o">=&gt;</span> <span class="nb">implode</span><span class="p">(</span>
		<span class="s1">'-'</span><span class="p">,</span>
		<span class="p">[</span>
			<span class="nv">$request</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">'year'</span><span class="p">),</span>
			<span class="nv">$request</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">'month'</span><span class="p">),</span>
			<span class="nv">$request</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">'day'</span><span class="p">)</span>
		<span class="p">]</span>
	<span class="p">)]);</span>
	<span class="k">return</span> <span class="k">parent</span><span class="o">::</span><span class="na">all</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="editing-request-data">Editing request data</h3>
<p>We can retrieve all the input data in an array from <code class="highlighter-rouge">parent::all()</code> . Then we can modify the existing elements of the array.</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">function</span> <span class="nf">all</span><span class="p">()</span>
<span class="p">{</span>
	<span class="nv">$input</span> <span class="o">=</span> <span class="k">parent</span><span class="o">::</span><span class="na">all</span><span class="p">();</span>
	<span class="c1">// assuming attributes will be json encoded data
</span>	<span class="c1">// convert to into associative array
</span>	<span class="c1">// can be useful for array validation
</span>	<span class="nv">$input</span><span class="p">[</span><span class="s1">'attributes'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">json_decode</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">'attributes'</span><span class="p">),</span> <span class="kc">true</span><span class="p">);</span>

	<span class="c1">// replaces the request data with new data
</span>	<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">replace</span><span class="p">(</span><span class="nv">$input</span><span class="p">);</span>
	<span class="k">return</span> <span class="k">parent</span><span class="o">::</span><span class="na">all</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<p>So by these ways, we can make our code cleaner by utilizing the request classes, and use them beyond validation.</p>

  </section>
  <section id="disqus_thread"></section><!-- /#disqus_thread -->
</article>

    <script type="text/javascript">
      var disqus_config = function () {
        this.page.url = 'https://sazanrjb.com.np/2018/leverage-laravels-form-request-optimize-and-make-code-cleaner/';  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = '/2018/leverage-laravels-form-request-optimize-and-make-code-cleaner'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
      };

      (function() { // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        s.src = '//sazanrjb.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
       })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>



      </div>

      <footer class="footer">
  <span class="footer__copyright">&copy; 2019 Sajan Rajbhandari. All rights reserved.</span>
</footer>

<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script type="text/javascript" src="/js/main.js?1564822324395785288"></script>


    </div>

    <!-- Instant Page -->
    <script src="//instant.page/1.1.0" type="module" integrity="sha384-EwBObn5QAxP8f09iemwAJljc+sU+eUXeL9vSBw1eNmVarwhKk2F9vBEpaN9rsrtp"></script>
    <!-- Go to www.addthis.com/dashboard to customize your tools --> 
    <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-53b8453850223d10"></script>
  </body>
</html>